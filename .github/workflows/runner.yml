# .github/workflows/runner.yml
name: Fetch Telegram Messages

# This action can be triggered manually or via API call
on:
  workflow_dispatch:
    inputs:
      api_id:
        description: 'Your Telegram API ID'
        required: true
      api_hash:
        description: 'Your Telegram API Hash'
        required: true
      session_string:
        description: 'Telegram Session String'
        required: true
      message_type:
        description: 'Type of messages to fetch (private, channel, all)'
        required: true
        default: 'private'
        type: choice
        options:
        - private
        - channel
        - all
      limit:
        description: 'Number of messages to fetch'
        required: false
        default: '10'

jobs:
  fetch-messages:
    runs-on: ubuntu-latest
    steps:
      - name: 1. Check out repository
        uses: actions/checkout@v4

      - name: 2. Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: 3. Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: 4. Run Telegram Fetcher Script
        run: |
          python telegram_fetcher.py \
            --api-id "${{ github.event.inputs.api_id }}" \
            --api-hash "${{ github.event.inputs.api_hash }}" \
            --session "${{ github.event.inputs.session_string }}" \
            --type "${{ github.event.inputs.message_type }}" \
            --limit "${{ github.event.inputs.limit }}"
